var $=Object.defineProperty,A=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var V=(l,o,s)=>o in l?$(l,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[o]=s,F=(l,o)=>{for(var s in o||(o={}))K.call(o,s)&&V(l,s,o[s]);if(B)for(var s of B(o))T.call(o,s)&&V(l,s,o[s]);return l},w=(l,o)=>A(l,I(o));import{_ as q,u as z,n as M,q as N,s as S,t as U,w as j}from"./index.87b6dd79.js";import{F as P}from"./index.9fcdf9ef.js";import{d as x,y,t as G,X,A as H,r,a as J,i as t,w as a,E,o as L,f as O,k as C}from"./vendor.26ab8f26.js";const Q=x({components:{FooterBtns:P},setup(){const{route:l,router:o}=z(),s=y(null),f=y(null),d=y(null),{formData:n,menu:c}=G(X({formData:{name:"",remark:"",menus:[],isDisable:0,sort:"",menuIds:""},menu:{permissionsTree:[],allAuthKeys:[]}})),h={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:["blur"],pattern:/(^[^\s]*$)/}],sort:[{required:!0,message:"\u8BF7\u8F93\u5165\u6392\u5E8F",trigger:"blur",pattern:/(^[0-9]\d*$)/}]},v=()=>{var e;(e=s.value)==null||e.validate(i=>{!i||(d.value?p():g())})},m=()=>{M().then(e=>{c.value.permissionsTree=e,console.log("res",e);const i=N(e,[],"children");c.value.allAuthKeys=i.map(_=>_.id)}).catch(e=>{console.log("err",e)})},g=()=>{n.value.menus.length==0?n.value.menuIds="":n.value.menuIds=n.value.menus.join(","),S(F({},n.value)).then(e=>{setTimeout(()=>{o.back()},500),E({type:"success",message:"\u4FDD\u5B58\u6210\u529F"})}).catch(e=>{console.log("err",e)})},p=()=>{n.value.menus.length==0?n.value.menuIds="":n.value.menuIds=n.value.menus.join(","),U(w(F({},n.value),{id:d.value})).then(e=>{console.log("res",e),setTimeout(()=>{o.back()},500),E({type:"success",message:"\u4FDD\u5B58\u6210\u529F"})}).catch(e=>{console.log("err",e)})},D=()=>{j({id:d.value}).then(e=>{var i;console.log("res",e),n.value=e,(i=f.value)==null||i.setCheckedKeys(e.menus)}).catch(e=>{console.log("err",e)})},b=(e,i)=>{if(console.log(e),!e.id)return;const _=n.value.menus.findIndex(R=>R==e.id);if(i){_==-1&&n.value.menus.push(e.id);return}_!=-1&&n.value.menus.splice(_,1)},k=()=>{var e;(e=f.value)==null||e.setCheckedKeys(c.value.allAuthKeys)},u=()=>{var e;(e=f.value)==null||e.setCheckedKeys([])};return H(()=>{const e=l.query;e.id&&(d.value=e.id*1,D()),m()}),{id:d,formData:n,menu:c,formRef:s,treeRef:f,rules:h,getMenu:m,roleAdd:g,roleEdit:p,roleDetail:D,onSubmit:v,handlePermissionsCheckChange:b,close:u,allSelect:k}}}),W={class:"role-edit"},Y={class:"flex",style:{"margin-top":"3px"}},Z=C(" \u5168\u9009 "),ee=C(" \u5168\u4E0D\u9009 "),oe=C("\u4FDD\u5B58");function le(l,o,s,f,d,n){const c=r("el-page-header"),h=r("el-card"),v=r("el-input"),m=r("el-form-item"),g=r("el-switch"),p=r("el-button"),D=r("el-tree"),b=r("el-form"),k=r("footer-btns");return L(),J("div",W,[t(h,{shadow:"never"},{default:a(()=>[t(c,{content:l.id?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272",onBack:o[0]||(o[0]=u=>l.$router.back())},null,8,["content"])]),_:1}),t(h,{shadow:"never",class:"m-t-15"},{default:a(()=>[t(b,{ref:"formRef",rules:l.rules,class:"ls-form",model:l.formData,"label-width":"150px",size:"small"},{default:a(()=>[t(m,{label:"\u540D\u79F0",prop:"name"},{default:a(()=>[t(v,{modelValue:l.formData.name,"onUpdate:modelValue":o[1]||(o[1]=u=>l.formData.name=u),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(m,{label:"\u5907\u6CE8",prop:"remark"},{default:a(()=>[t(v,{modelValue:l.formData.remark,"onUpdate:modelValue":o[2]||(o[2]=u=>l.formData.remark=u),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea",autosize:{minRows:4,maxRows:6}},null,8,["modelValue"])]),_:1}),t(m,{label:"\u6392\u5E8F",prop:"sort"},{default:a(()=>[t(v,{modelValue:l.formData.sort,"onUpdate:modelValue":o[3]||(o[3]=u=>l.formData.sort=u),placeholder:"\u8BF7\u8F93\u5165",type:"number"},null,8,["modelValue"])]),_:1}),t(m,{label:"\u72B6\u6001"},{default:a(()=>[t(g,{modelValue:l.formData.isDisable,"onUpdate:modelValue":o[4]||(o[4]=u=>l.formData.isDisable=u),"active-value":0,"inactive-value":1},null,8,["modelValue"])]),_:1}),t(m,{label:"\u6743\u9650",prop:"auth_keys"},{default:a(()=>[O("div",Y,[t(p,{type:"text",size:"mini",onClick:o[5]||(o[5]=u=>l.allSelect())},{default:a(()=>[Z]),_:1}),t(p,{type:"text",size:"mini",onClick:o[6]||(o[6]=u=>l.close())},{default:a(()=>[ee]),_:1})]),t(D,{ref:"treeRef",data:l.menu.permissionsTree,"node-key":"id","default-expand-all":"",icon:"ArrowRight",props:{children:"children",label:"menuName"},"empty-text":"","show-checkbox":"",onCheckChange:l.handlePermissionsCheckChange},null,8,["data","onCheckChange"])]),_:1})]),_:1},8,["rules","model"])]),_:1}),t(k,null,{default:a(()=>[t(p,{type:"primary",size:"small",onClick:l.onSubmit},{default:a(()=>[oe]),_:1},8,["onClick"])]),_:1})])}var ae=q(Q,[["render",le],["__scopeId","data-v-4b9bc47e"]]);export{ae as default};
